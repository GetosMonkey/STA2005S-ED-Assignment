---
title: " üìä Experimental Design Project"
subtitle: "STA2005S - 2025"
author: 
  - "Maryam Abrahams (ABRMAR043)"
  - "Bheka Mabika (MBKBHE002)"
format: pdf
---

# Plagiarism Statement: 

# üå∂Ô∏è Introduction:

The two chilli farmers, Ms Hopeful and Mr Growing, compete head to head for the hearts and minds of the South African chilli market. But despite their names Ms Hopeful seems to always get higher chilli yields than Mr Growing. In Mr Growing's eyes this cannot continue.

### Aim:

This experiment aims to systematically evaluate the effect of light levels, heat levels and chilli variety on crop quality and yield. With our results we will be able to give evidence-based recommendations on optimal growing conditions.

**Particularly we seek to answer:**

1.  Which light and heat settings produce the highest quality chillies?

2.  Does the above depend on variety?

3.  Does quality depend on variety?

4.  How big are the differences?

### Priori Hypothesis:

Prior to collecting the data, we hypothesize:

-   $H{1}$: Quality and yield will increase as light increases and with moderate heat levels, as either extreme of heat can lead to some form of denaturing of the plant's cells.

-   $H{2}$: Although their would be natural differences between varieties of chillies the light-heat response patterns will be similar between varieties.

-   $H{3}$: Quality of chilli would be heavily dependent on variety as taste, and look are variety-specific.

- $H{4}$: Side (North/South) has a negligible effect.

---

```{r setup, include=FALSE}

# Imports, libraries, and setup 

install.packages("EDproject_2.0.zip", repos = NULL, type = "win.binary")

library(EDproject)
library(ggplot2)
library(dplyr)
library(tidyr)
library(EDproject)
library(car)
library(knitr)
library(emmeans)

# Set global format options
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, 
                      fig.width = 6, fig.height = 4, fig.align = "center")

# Making a color Palette for my document: 
col_palette = c (
  "#0B1D39", 
  "#333333",
  "#666666",
  "#D3D3D3",
  "#f8f8f8", 
  "#F5F5F5",
  "#007ACC",
  "#1DB954",
  "#FF6F61",
  "#f9c74f"
  
)
```

# üîç Experimental Design and Randomization:

## Simulating data:

We created the design matrix in accordance to a **Nested Latin Square design**, similar to a factorial design, however since we lack the resources needed to experiment on every possible combination, instead we pick combinations all necessary combinations needed to represent the effects of the different light and heat levels on the chillies.

**treatment factors:**

-   Light: 4 levels (1, 2, 3, 4)

-   Heat: 4 levels (1, 2, 3, 4)

$\implies 16$ unique treatments

**blocking factors:**

-   Season: (1, 2)

-   Greenhouse: (A, B)

-   Side of greenhouse: (N = north-facing, S = south-facing)

-   Chilli variety: (R = red-hot, F = furious)

![Blocking example greenhouse](Example_setup.png)

**Design:**

Within our design we have an outer $2\times2$ Latin square design, creating a 4 outer blocks separating the 4 possible combinations of the 2 greenhouses (A & B) and the 2 seasons. Each of these represents a separate experimental block.

- Block 1 = Season 1 √ó Greenhouse A\
- Block 2 = Season 1 √ó Greenhouse B\
- Block 3 = Season 2 √ó Greenhouse A\
- Block 4 = Season 2 √ó Greenhouse B

Inside each block, there is an inner $2\times2$ Latin square layer, creating a 4 block grid. The variety (*Redhot* or *Furious*) and side (*North* or *South*) were assigned according to the plan shown below:

| Side  | Variety      | Description |
|-------|--------------|-------------|
| North | Redhot (RN)  | 4 plots     |
| North | Furious (FN) | 4 plots     |
| South | Redhot (RS)  | 4 plots     |
| South | Furious (FS) | 4 plots     |

This gives 8 plots per variety and 8 plots per side in each block ‚Äî ensuring full balance within every greenhouse‚Äìseason combination.

Then, within each side-variety combination, we assign random heat and light levels. This means that Inside each block, all **16 combinations** of **Heat (H1‚ÄìH4)** and **Light (L1‚ÄìL4)** were used once, creating a full factorial of the two treatment factors.\
These 16 Heat‚ÄìLight combinations were **randomised independently** within each block to reduce bias.

The overarching structure is thus such that: Heat-Light is nested within Side-variety which are is nested Season-greenhouse combinations.

![Blocking factors Diagram](Blocking_factors_pic.png){width=70%}


### Randomization:

Each side-variety combination gets its own independent randomization of heat and light such that there is no systematic crossing of all 4 heat levels $\times$ all 4 light levels $\times$ all sides $\times$ all varieties. In this way all levels of heat and light respectively are represented in a balanced manner, but not all combinations of heat and light with the other variables are tested.

In this way there is confounding of higher order combinations but this is due to our restrictive number of available plots and resource limitations. The combination of our clever blocking within the design as well as the use of randomization mitigates the effects of this potential confounding.

### Simulation: 

The simulated quality data was generated using the **`get.observations()`** function with a fixed random seed (**`set.seed(22)`**) to ensure reproducibility.

The generated design matrix was also validated with a loop which checks for correct randomization and that each heat-light combination is used once per side-variety combination.

------------------------------------------------------------------------

```{r}
set.seed(22)

# Outer Latin Square: Determines outer block position
outer_latin_square <- data.frame(
              season = c(1, 1, 2, 2),
              greenhouse = c("A", "B", "A", "B"),
              outer_block = c(1, 2, 3, 4)
)

# Assigning heat and light levels balanced
create_nested_ls <- function(block_id) {
  
  # 4 side-variety combos
  side_var_combos <- expand.grid(
    side = c("n", "s"), 
    variety = c("R", "F")
  )

  design <- data.frame()
  
  for (i in 1:nrow(side_var_combos)) {
    heat_order <- sample(1:4)
    light_order <- sample(1:4)
    combo_design <- data.frame(
      side = rep(side_var_combos$side[i], 4),
      variety = rep(side_var_combos$variety[i], 4),
      heat = heat_order,
      light = light_order
    )
    
    design <- rbind(design, combo_design)
  }
  
  return(design)
}

# Generating the design for all 4 outer blocks
all_designs <- list()

for (i in 1:nrow(outer_latin_square)){
  block_design <- create_nested_ls()
  block_design$season <- outer_latin_square$season[i]
  block_design$greenhouse <- outer_latin_square$greenhouse[i]
  block_design$outer_block <- outer_latin_square$outer_block[i]
  all_designs[[i]] <- block_design
}

# Combining blocks
final_design <- do.call(rbind, all_designs)
final_design$plot <- 1:nrow(final_design)

design_csv <- final_design[c("season", "greenhouse", "light", "heat", "variety", "side", "plot")]
```

```{r, include= FALSE}

cat("--- Design Validation Check ---\n\n")

# unique combinations of s and gh
all_main_blocks <- unique(design_csv[, c("season", "greenhouse")])

for (i in 1:nrow(all_main_blocks)) {
  
  s <- all_main_blocks$season[i]
  gh <- all_main_blocks$greenhouse[i]
  
  cat(paste("========================================\n"))
  cat(paste("    Checking Season:", s, "| Greenhouse:", gh, " \n"))
  cat(paste("========================================\n"))
  

  current_block_data <- subset(design_csv, season == s & greenhouse == gh)
  
  side_variety_combos <- sort(unique(paste(current_block_data$side, current_block_data$variety)))
  

  for (sv in side_variety_combos) {
    cat("\n  Sub-block (Side / Variety):", sv, "\n")
    subset_data <- current_block_data[paste(current_block_data$side, current_block_data$variety) == sv, ]
    cat("    > Heat levels present: ", paste(sort(unique(subset_data$heat)), collapse=", "), "\n")
    cat("    > Light levels present:", paste(sort(unique(subset_data$light)), collapse=", "), "\n")
  }
  cat("\n")
}

cat("--- Validation Complete ---\n")

# Write file
write.csv(design_csv, "design.csv", row.names = FALSE, quote = FALSE)

```

```{r}

# Obtaining observations:
design <- read.csv("design.csv")
mydata <- get.observations(design)

mydata
```

------------------------------------------------------------------------

# üßÆ Analysis and Results:

### Fitting the models and checking assumptions:

```{r , include=FALSE}

# Convert variables to factors ---------------------------------------------
dat <- na.omit(mydata)
dat$season     <- factor(dat$season)
dat$greenhouse <- factor(dat$greenhouse)
dat$heat       <- factor(dat$heat)
dat$light      <- factor(dat$light)
dat$variety    <- factor(dat$variety)
dat$side       <- factor(dat$side)
dat$block      <- interaction(dat$season, dat$greenhouse, drop = TRUE)

# Fit model ------------------------------------------------------------------
fit <- lm(obs ~ block + heat*light*variety + side, data = dat)

# Model summary --------------------------------------------------------------
summary(fit)
```

The model uses **block** to adjust for background variation across the four Latin Square positions (the combinations of Season and Greenhouse).\

It then tests how **heat**, **light**, and **variety** affect the response and whether they interact.\

The **side** factor is included only to correct for small layout or position effects within each greenhouse.

## ANOVA:

The experiment used a **Latin Square design** with **Season √ó Greenhouse** forming the **2√ó2 blocking structure**, and a full factorial of\

**Heat (4 levels)** √ó **Light (4 levels)** √ó **Variety (2 levels)**.

The fitted linear model was:

$$
\text{obs} = \text{block} + \text{heat} \times \text{light} \times \text{variety} + \text{side}
$$

```{r, include=FALSE}
# Type I ANOVA
anova(fit)

# Type II ANOVA
Anova(fit, type = 2)
```

### Model fit:

**R¬≤ = 0.968**, Adjusted **R¬≤ = 0.931** ‚Üí the model explains most of the variation in quality.\
**Residual SE = 1.76** ‚Üí small compared to the treatment range.\
No clear outliers or leverage points were found when checking diagnostic plots.\
Two coefficients were undefined because of overlap between some factors, which is expected in a full factorial design.

### Interpretation:

Both **light** and **heat** increased mean quality, with **light intensity** having the strongest influence (p \< 0.001).\
**Heat** also affected quality (p \< 0.001), though to a smaller extent.\
**Variety** showed a mild difference (p = 0.018), where variety **R** performed slightly better than **F**.\
The **block** term (p = 0.0067) shows that adjusting for season and greenhouse helped control background variation.\
The **side** factor (p = 0.015) had a small effect, possibly linked to minor position or orientation differences.\
All **interaction terms** (e.g., heat √ó light) had p-values above 0.1, suggesting the effects act independently.

Overall, the results show that most of the change in quality can be explained by the main treatment factors ‚Äî especially light ‚Äî and the blocking effectively reduced environmental variation.

### Model Diagnostics:

```{r diagnostics, fig.height=6, fig.width=7, fig.cap="Residual diagnostic plots showing no serious violations of model assumptions. The Q-Q plot indicates approximate normality, and the residuals vs. fitted plot shows no strong patterns suggesting heteroscedasticity."}

# Check residual assumptions -----------------------------------------------

par(mfrow = c(2, 2), mar = c(4, 4, 2, 1))
plot(fit, which = 1, col = col_palette[1])  # Residuals vs Fitted
plot(fit, which = 2, col = col_palette[1])  # Normal Q‚ÄìQ
plot(fit, which = 3, col = col_palette[1])  # Scale‚ÄìLocation
plot(fit, which = 5, col = col_palette[1])  # Residuals vs Leverage
par(mfrow = c(1, 1))

```

Both **light** and **heat** increased mean quality, with **light intensity** having the strongest influence (p \< 0.001).

\
**Heat** also affected quality (p \< 0.001), though to a smaller extent.

**Variety** showed a mild difference (p = 0.018), where variety **R** performed slightly better than **F**.

\
The **block** term (p = 0.0067) shows that adjusting for season and greenhouse helped control background variation.

\
The **side** factor was aliased in the Type II ANOVA, meaning it was linearly dependent on other variables in the model.

\
This suggests that side orientation (north/south) did not contribute additional information once **block**, **heat**, **light**, and **variety** were included.\
Any minor variation linked to side was already captured by the blocking structure (Season √ó Greenhouse).

\
All **interaction terms** (e.g., heat √ó light) had p-values above 0.1, suggesting that the effects act independently.

## Treatment Effects Visualization:

### Interaction plots:

```{r , fig.height=5, fig.width=10, fig.cap="Interaction plots for mean quality based on Heat and Light levels, aggregated across both varieties."}

# Interaction plots: 
par(mfrow = c(1,2))

# quality vs LIGHT by HEAT
interaction.plot(x.factor = dat$light, trace.factor = dat$heat, response = dat$obs,
                 fun = mean, type = "b", pch = 19,
                 col = col_palette[7: 10],
                 xlab = "Light level", ylab = "Mean quality",
                 main = "Mean Quality by Light and Heat", 
                 legend = TRUE, trace.label = "Heat")

# quality vs HEAT by LIGHT
interaction.plot(x.factor = dat$heat, trace.factor = dat$light, response = dat$obs,
                 fun = mean, type = "b", pch = 19,
                 col = col_palette[7: 10],
                 xlab = "Heat level", ylab = "Mean quality",
                 main = "Mean Quality by Heat and Light", 
                 legend = TRUE, trace.label = "Light")
par(mfrow = c(1,1))
```

```{r, fig.height=5, fig.width=10, fig.cap="Heat x Light interaction plots for mean quality, shown separately for Variety R (left) and Variety F (right)"}

# By variety
par(mfrow = c(1,2))
with(subset(dat, variety == "R"),
     interaction.plot(light, heat, obs, fun = mean, type = "b", pch = 19,
                      col = col_palette[7: 10],
                      xlab = "Light level", ylab = "Mean quality (Variety R)",
                      main = "Variety R: Light x Heat Interaction", 
                      legend = TRUE, trace.label = "Heat"))
with(subset(dat, variety == "F"),
     interaction.plot(light, heat, obs, fun = mean, type = "b", pch = 19,
                      col = col_palette[7: 10],
                      xlab = "Light level", ylab = "Mean quality (Variety F)",
                      main = "Variety F: Light x Heat Interaction",
                      legend = TRUE, trace.label = "Heat"))
par(mfrow = c(1,1))

```
### Interpretation: 

From observation, the interaction plots appear to show strong interactions, as the lines are clearly not parallel. In the "Variety R" plot, the lines cross over each other, while in the "Mean Quality by Light and Heat" plot, the lines have very different slopes. This pattern suggests the factors are dependent implying effect of Light depends on the Heat level.Furthermore, the interaction pattern for "Variety R" looks completely different from the pattern for "Variety F," which suggests a 3-way interaction ($Heat \times Light \times Variety$).

Despite this, we must treat this interpretation cautiously because these plots show raw data means, but our design is unbalanced due to missing observations making them statistically misleading/unreliable. Thus the only valid conclusions about interactions must come from ANOVA or plotting the model's Estimated Marginal Means.

### Mean plots:

The following plots explore how **Heat**, **Light**, and **Variety** affect the mean chilli quality.\
Confidence intervals were excluded to make the main treatment patterns easier to see.

```{r , fig.height=5, fig.width=10, fig.cap="Mean quality stratified by Variety. The plot shows mean quality by Light level (with lines for Heat)"}

# ================================================================
#  Mean plots WITHOUT CIs
# ================================================================

# Ensure factors are correctly coded

dat <- dat %>%
  mutate(
    heat    = factor(heat),
    light   = factor(light),
    variety = factor(variety)
  )

# Summarise means

sumdat <- dat %>%
  group_by(light, heat, variety) %>%
  summarise(
    mean = mean(obs),
    .groups = "drop"
  )

# 1) Mean quality by LIGHT, by Variety
ggplot(sumdat, aes(x = light, y = mean, group = heat,
                   linetype = heat, shape = heat)) +
  geom_line() +
  geom_point(size = 2) +
  facet_wrap(~ variety) +
  labs(title = "Mean quality by Light (lines = Heat), stratified by Variety",
       x = "Light level", y = "Mean quality",
       linetype = "Heat", shape = "Heat") +
  theme_minimal(base_size = 13) + 
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))

```

```{r, fig.height=5, fig.width=10, fig.cap="Mean quality stratified by Variety. The plot shows mean quality by Heat level (with lines for Light)"}

# 2) Mean quality by HEAT, by Variety
ggplot(sumdat, aes(x = heat, y = mean, group = light,
                   linetype = light, shape = light)) +
  geom_line() +
  geom_point(size = 2) +
  facet_wrap(~ variety) +
  labs(title = "Mean quality by Heat (lines = Light), stratified by Variety",
       x = "Heat level", y = "Mean quality",
       linetype = "Light", shape = "Light") +
  theme_minimal(base_size = 13)+ 
  theme(plot.title = element_text(hjust = 0.5, face = "bold")) 


```

```{r, , fig.height=4, fig.width=7, fig.cap="Mean quality by Light level, showing the combined Heat x Light x Variety interaction. Line type represents the Heat level, and color represents the Variety"}

# 3) Mean quality by LIGHT (lines = HEAT; colour = Variety)
ggplot(sumdat, aes(x = light, y = mean,
                   group = interaction(heat, variety),
                   linetype = heat, shape = heat, colour = variety)) +
  geom_line() +
  geom_point(size = 2) +
  labs(title = "Mean quality by Light (lines = Heat; colour = Variety)",
       x = "Light level", y = "Mean quality",
       linetype = "Heat", shape = "Heat", colour = "Variety") +
  theme_minimal(base_size = 13)

```

### Interpretation of Mean Plots

The three mean plots above show the relationships between **Heat**, **Light**, and **Variety** on average chilli quality.

#### Mean quality by Light (lines = Heat), faceted by Variety

-   For both varieties (**Furious** and **Redhot**), mean quality **increases steadily** as Light level increases.\
-   The lines for different Heat levels move upward together, meaning that **higher Light improves quality across all Heat levels**.\
-   *Furious* generally achieves **slightly higher mean quality** than *Redhot*.

**Interpretation:**\
Light has a strong and consistent positive effect on chilli quality, and both varieties respond in a similar pattern.

#### Mean quality by Heat (lines = Light), faceted by Variety

-   The lines are **more scattered** with no clear trend as Heat increases.\
-   This suggests that **Heat‚Äôs effect on quality is weaker and less consistent** across all Light levels.\
-   Both varieties show small ups and downs, but no steady direction.

**Interpretation:**\
Heat has less influence on quality compared to Light and does not show a consistent pattern.

#### Mean quality by Light (lines = Heat; colour = Variety)

-   Both *Furious* (red) and *Redhot* (blue) lines **rise with increasing Light**, showing that Light has a strong overall effect.\
-   The shapes of the lines are **very similar between varieties**, and they rarely cross, meaning **no major interactions**.\
-   *Furious* tends to have **slightly higher quality scores overall**.

**Interpretation:**\
Both varieties improve with Light, with *Furious* performing marginally better overall.\
The effects of Heat, Light, and Variety appear largely independent.

### Overall Summary

Across all plots:

-   **Light** shows the **strongest positive effect** on chilli quality.\
-   **Heat** has a **smaller and less consistent influence**.\
-   **Variety** has a **minor main effect**, with *Furious* slightly outperforming *Redhot*.\
-   The mostly **parallel pattern of lines** suggests **weak or no interactions** among the factors.

---

### Analysis Procedures

**Missing Values**: Cases with missing observations were excluded from analysis using complete-case analysis, resulting in `r nrow(na.omit(mydata))` observations for model fitting.

**ANOVA**: We used Type II sums of squares to test main effects and interactions, as this approach appropriately handles unbalanced designs caused by missing data and tests each effect after accounting for all other effects at the same or lower level.

**Multiple Testing**: Given the exploratory nature of this study and the relatively small number of pre-specified hypotheses, we report both unadjusted p-values and note effects significant at Œ± = 0.05. For post-hoc pairwise comparisons, we apply Tukey's HSD adjustment.

**Model Diagnostics**: We examined residual plots (residuals vs. fitted, Q-Q plot, scale-location, and leverage plots) to verify assumptions of normality, homoscedasticity, and identify potential outliers.

**Effect Estimation**: We computed estimated marginal means (EMMs) with 95% confidence intervals for all treatment combinations.

------------------------------------------------------------------------

# üßë‚Äçüåæ Conclusions:

This section fits the full model (**obs \~ block + heat $\times$ times $\times$ light $\times$ variety + side**), runs Type-II ANOVA, extracts estimated marginal means with the **emmeans** package, answers the four farmer questions, and builds a cost-aware decision table. Plots and tables are produced inline.

```{r}
anova_tbl <- Anova(fit, type = 2)
anova_tbl

```

**Reading the ANOVA:**

-   Interactions with **variety** (heat:variety, light:variety, heat:light:variety) are **non-significant** ‚Üí patterns don‚Äôt depend on variety.

-   **Light** is strongly significant; **Heat** is weaker.

-   **Variety** shows a small main effect.

-   **Side** adds little after blocking; keep it per design.

### üîé Q1 ‚Äî Which Heat √ó Light is best?

```{r}
emm_hl      <- emmeans(fit, ~ heat * light)
emm_hl_sum  <- summary(emm_hl)
emm_hl_pairs<- pairs(emm_hl, adjust = "tukey")

kable(emm_hl_sum, digits = 2, caption = "EMMs: Heat √ó Light")
emm_hl_pairs

```

**Answer:** Highest mean quality is at **Heat 3 √ó Light 4**. Next best are typically **H4√óL3** and **H3√óL3** (small drops from the best). Tukey shows many low-HL combos are clearly worse.

### üå± Q2 ‚Äî Do best settings depend on Variety?

```{r}
emm_hl_by_v <- emmeans(fit, ~ heat * light | variety)
best_by_v <- summary(emm_hl_by_v) |>
group_by(variety) |>
slice_max(emmean, n = 1, with_ties = FALSE)
kable(best_by_v, digits = 2, caption = "Best Heat√óLight within each Variety")

```

**Answer:** **No**. Best HL pattern is essentially the same for both varieties (interactions ns).

### üçÖ Q3 ‚Äî Does quality depend on Variety?

```{r}
emm_var     <- emmeans(fit, ~ variety)
emm_var_sum <- summary(emm_var)
var_contr   <- contrast(emm_var, "pairwise", adjust = "tukey")

kable(emm_var_sum, digits = 2, caption = "Variety means (EMMs)")
var_contr

```

**Answer:** **Yes, slightly.** *Redhot* ‚âà **1.15** points higher than *Furious* (p ‚âà 0.017).

### üìà Mean plots (no CIs; simple patterns)

```{r}
sumdat <- dat |>
mutate(
heat=factor(heat),
light=factor(light),
variety=factor(variety)
) |>
group_by(light, heat, variety) |>
summarise(mean = mean(obs), .groups="drop")

# 1) Mean by Light; lines = Heat; facet Variety

ggplot(sumdat, aes(x=light, y=mean, group=heat, linetype=heat, shape=heat)) +
geom_line() + geom_point(size=2) +
facet_wrap(~ variety) +
labs(title="Mean quality by Light (lines = Heat), faceted by Variety",
x="Light level", y="Mean quality", linetype="Heat", shape="Heat") +
theme_minimal(base_size = 13)

# 2) Mean by Heat; lines = Light; facet Variety

ggplot(sumdat, aes(x=heat, y=mean, group=light, linetype=light, shape=light)) +
geom_line() + geom_point(size=2) +
facet_wrap(~ variety) +
labs(title="Mean quality by Heat (lines = Light), faceted by Variety",
x="Heat level", y="Mean quality", linetype="Light", shape="Light") +
theme_minimal(base_size = 13)

# 3) Mean by Light; lines = Heat; colour = Variety

ggplot(sumdat, aes(x=light, y=mean,
group=interaction(heat,variety),
linetype=heat, shape=heat, colour=variety)) +
geom_line() + geom_point(size=2) +
labs(title="Mean quality by Light (lines = Heat; colour = Variety)",
x="Light level", y="Mean quality",
linetype="Heat", shape="Heat", colour="Variety") +
theme_minimal(base_size = 13)

```

**Reading the plots:**

-   **Light** rises cleanly ‚Üí strong positive effect.

-   **Heat** shows smaller, less consistent shifts.

-   Varieties move in parallel ‚Üí no meaningful interactions.

### ‚öñÔ∏è Q4 ‚Äî How big are differences? (rank & cost-aware choice)

```{r}
decision_tbl <- emm_hl_sum |>
as.data.frame() |>
mutate(
heat  = as.integer(as.character(heat)),
light = as.integer(as.character(light))
) |>
rename(mean = emmean, lower = lower.CL, upper = upper.CL) |>
arrange(desc(mean)) |>
mutate(best_mean = first(mean),
delta_vs_best = mean - best_mean,   # negative = lower than best
energy_proxy = heat + light) |>
select(heat, light, mean, lower, upper, delta_vs_best, energy_proxy)

kable(decision_tbl, digits = 2,
caption = "Ranked Heat√óLight (Œî = mean ‚àí best; energy proxy = heat + light)")

near_optimal <- decision_tbl |>
filter(delta_vs_best >= -2.0) |>
arrange(energy_proxy, desc(mean))

kable(near_optimal, digits = 2,
caption = "Near-optimal within 2 points of best (sorted by energy proxy)")

```

**Observation:**

-   **Best:** **H3√óL4** (energy proxy 7).

-   **Near-ties:** **H4√óL3** (‚âà ‚àí1.1, energy 7).

-   **Cheaper tolerance option:** **H3√óL3** (‚âà ‚àí1.7, energy 6).

## Optimal Conditions

```{r best-combinations}

# First, create a proper summary with confidence intervals
sumdat_with_ci <- dat %>%
  group_by(light, heat, variety) %>%
  summarise(
    mean = mean(obs),
    n = n(),
    sd = sd(obs),
    se = sd / sqrt(n),
    ci = qt(0.975, df = n-1) * se,  # 95% CI
    .groups = "drop"
  )

# Then find top combinations with proper CIs
top_combos <- sumdat_with_ci %>%
  arrange(desc(mean)) %>%
  mutate(
    mean_quality = mean,
    ci_lower = mean - ci,
    ci_upper = mean + ci
  ) %>%
  head(3)

kable(top_combos[, c("variety", "light", "heat", "mean_quality", "ci_lower", "ci_upper")],
      digits = 2,
      caption = "Top three treatment combinations by mean quality score",
      col.names = c("Variety", "Light", "Heat", "Mean Quality", "CI Lower", "CI Upper"),
      align = c("l", "c", "c", "r", "r", "r"))

```
.

-   **Cost-aware recommendation:** 

---

# üåû Future Reccomendations:

**Primary Recommendation**: Based on this experiment, we recommend a **Heat 3 √ó Light 4** setting for maximizing chili quality. Moderate heat and high light leads to best crop quality and yield.

**Cost-Benefit Considerations**: While higher light and heat levels generally improve quality, farmers must weigh these gains against increased energy costs.

**Variety Selection**: ** *Redhot* ‚âà **1.15** points higher than *Furious* (p ‚âà 0.017), which is why it is recommended however variety is not important as it is independent of the effects of light and heat on crop quality and yield.(all HL√óVar interactions non-significant).

**Practical Implementation**: - If energy is a concern, **H4√óL3** (‚âà ‚àí1.1) or **H3√óL3** (‚âà ‚àí1.7; lower proxy) are practical alternatives.

## Study Limitations

1.  **Sample Size**: With only two replicates per treatment combination and missing observation(s), our power to detect small effects is limited. Confidence intervals for some comparisons are wide.

2.  **Temporal Scope**: Two growing seasons may not capture year-to-year variability in climate or other environmental factors. Long-term validation is recommended.

3.  **Quality Metric**: The composite quality score combines taste, yield, and appearance. Economic returns may depend more heavily on one component (e.g., yield). Future studies should examine these components separately.

4.  **Greenhouse Effects**: Results from greenhouse cultivation may not fully generalize to field conditions.

5.  **Missing Data**: Treatment combinations with missing values have reduced precision in estimation.

## Future Directions

-   Replicate the experiment with larger sample sizes to narrow confidence intervals
-   Conduct economic analysis incorporating energy costs and market prices
-   Separate quality into components (taste, yield, appearance) for targeted optimization\
-   Test intermediate settings between levels to fine-tune recommendations
-   Evaluate performance under varying weather conditions across multiple years

------------------------------------------------------------------------

# References:

-   STA2005S Experimental Design Project (2025) handout. Department of Statistical Sciences, UCT.
-   R Core Team (2025). *R: A Language and Environment for Statistical Computing*. R Foundation for Statistical Computing, Vienna.
-   Fox, J. & Weisberg, S. (2019). *An R Companion to Applied Regression* (3rd ed.). (used for `car::Anova`)
-   Lenth, R. V. (2024). *emmeans: Estimated Marginal Means*. R package.
-   Wickham, H., Fran√ßois, R., Henry, L., & M√ºller, K. (2023). *dplyr: A Grammar of Data Manipulation*. R package.
-   Wickham, H. (2016). *ggplot2: Elegant Graphics for Data Analysis*. Springer. (used for plots)

------------------------------------------------------------------------
